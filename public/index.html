<!DOCTYPE html>
<html>
<head>
  <style>
    /* 스타일링을 위한 CSS */
    #container {
      display: flex;
    }
    #left-container {
      position: relative;
      width: 800px;
      height: 800px;
      border: 1px solid black;
      overflow: hidden; /* 컨테이너 내에서 벗어나지 않도록 */
    }
    #right-container {
      width: 200px;
      padding: 10px;
    }
    .cat {
      position: absolute;
      width: 50px;
      height: 50px;
      transition: transform 0.2s; /* 변환 애니메이션 설정 */
    }
    .flipped { /* 반전된 이미지에 대한 스타일 */
      transform: scaleX(-1);
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="left-container"></div>
    <div id="right-container">
      <button id="createCatButton">고양이 생성</button>
      <button id="speedButton">속도 조절</button>
    </div>
  </div>
  <script>
    const leftContainer = document.getElementById('left-container');
    const createCatButton = document.getElementById('createCatButton');
    const speedButton = document.getElementById('speedButton');
    let cat = null;
    let speedMultiplier = 1;
    let isMoving = false; // 움직이는 상태 여부

    createCatButton.addEventListener('click', () => {
      if (cat) {
        leftContainer.removeChild(cat);
      }
      const randomX = Math.random() * (leftContainer.offsetWidth - 50);
      const randomY = Math.random() * (leftContainer.offsetHeight - 50);
      cat = createCat(randomX, randomY);
      // 시작 시 stopping.gif로 변경
      cat.src = './stopping.gif';
    });

    speedButton.addEventListener('click', () => {
      speedMultiplier *= 2;
      if (speedMultiplier > 4) {
        speedMultiplier = 1;
      }
    });

    leftContainer.addEventListener('mousedown', (e) => {
      if (cat) {
        isMoving = true; // 움직이는 상태로 설정
        const catRect = cat.getBoundingClientRect();
        const centerX = catRect.width / 2;
        const centerY = catRect.height / 2;
        let x = e.clientX - leftContainer.getBoundingClientRect().left - centerX;
        let y = e.clientY - leftContainer.getBoundingClientRect().top - centerY;

        // 컨테이너 경계 안으로 제한
        x = Math.max(centerX, Math.min(leftContainer.offsetWidth - centerX, x));
        y = Math.max(centerY, Math.min(leftContainer.offsetHeight - centerY, y));

        // 이미지를 좌우반전하는 클래스 추가/제거
        if (x < catRect.left + centerX) {
          cat.classList.remove('flipped');
        } else {
          cat.classList.add('flipped');
        }

        // 클릭 시 movingcat.gif로 변경
        cat.src = './movingcat.gif';
        moveCat(cat, x, y);
      }
    });

    leftContainer.addEventListener('transitionend', () => {
      if (isMoving) {
        isMoving = false;
        // 도달했을 때 stopping.gif로 변경
        cat.src = './stopping.gif';
      }
    });

    function createCat(x, y) {
      const cat = document.createElement('img');
      cat.src = './stopping.gif'; // 초기에 정지 상태 이미지로 설정
      cat.className = 'cat';
      leftContainer.appendChild(cat);
      cat.style.left = x + 'px';
      cat.style.top = y + 'px';
      return cat;
    }

    function moveCat(cat, x, y) {
      if (!isMoving) return; // 움직이지 않는 상태라면 함수 종료
      const catRect = cat.getBoundingClientRect();
      const centerX = catRect.width / 2;
      const centerY = catRect.height / 2;

      // 컨테이너 경계 안으로 제한
      x = Math.max(centerX, Math.min(leftContainer.offsetWidth - centerX, x));
      y = Math.max(centerY, Math.min(leftContainer.offsetHeight - centerY, y));

      const deltaX = x - (catRect.left + centerX);
      const deltaY = y - (catRect.top + centerY);
      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

      const duration = (distance / 100) / speedMultiplier;

      cat.style.transition = `left ${duration}s, top ${duration}s`;
      cat.style.left = x - centerX + 'px';
      cat.style.top = y - centerY + 'px';
    }
  </script>
</body>
</html>
